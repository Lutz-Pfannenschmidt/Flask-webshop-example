<!DOCTYPE html>
<html lang="en">
<head>
  <title>Webshop | Cart</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  <style>
    /* Remove the navbar's default rounded borders and increase the bottom margin */ 
    .navbar {
      margin-bottom: 50px;
      border-radius: 0;
    }
    
    /* Remove the jumbotron's default bottom margin */ 
     .jumbotron {
      margin-bottom: 0;
    }
   
    /* Add a gray background color and some padding to the footer */
    footer {
      background-color: #f2f2f2;
      padding: 25px;
    }
	ul.dropdown-menu {
		background-color: #333;
	}
	ul.dropdown-menu li a{
		background-color: #333;
		color: #9d9d9d;
	}
	ul.dropdown-menu li a:hover{
		background-color: #333;
		color: #fff;
	}
  </style>
</head>
<body>

<div class="jumbotron">
  <div class="container text-center">
    <h1>Online Store</h1>      
    <p>Template by: <a href="https://www.w3schools.com/bootstrap/tryit.asp?filename=trybs_temp_store&stacked=w">w3schools</a></p>
  </div>
</div>

<nav class="navbar navbar-inverse">
	<div class="container-fluid">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>                        
			</button>
			<a class="navbar-brand" href="#">Logo</a>
		</div>
		<div class="collapse navbar-collapse" id="myNavbar">
			<ul class="nav navbar-nav">
				<li><a href="{{ root }}home">Home</a></li>
				<li><a href="{{ root }}products">Products</a></li>
				<li><a href="#">Deals</a></li>
				<li><a href="#">Stores</a></li>
				<li><a href="#">Contact</a></li>
			</ul>
			<ul class="nav navbar-nav navbar-right ">
				<li class="dropdown">
					<a href="#" class="dropdown-toggle dropdown-header" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><span class="glyphicon glyphicon-user"></span> Your Account <span class="caret"></span></a>
					<ul class="dropdown-menu">
						<li><a href="#">Dashboard</a></li>
						<li><a href="#">Orders</a></li>
						<li><a href="#">Settings</a></li>
						<li role="separator" class="divider"></li>
						<li><a href="#">Log out</a></li>
					</ul>
				</li>
				<li class="active"><a href="#"><span class="glyphicon glyphicon-shopping-cart"></span> Cart (<span id="items_in_cart">{{ cart }}</span>)</a></li>
			</ul>
		</div>
	</div>
</nav>

<input type="hidden" id="items_in_cart_hidden" value="{{ cart }}">

<div class="container">    
	<div class="row">
		
		{% if cart > 0 %}
		
		<div class="panel panel-default">
			<!-- Default panel contents -->
			<div class="panel-heading">Items in your cart</div>
		
			<!-- Table -->
			<table class="table">
				<tr>
					<th>Item name</th>
					<th>Item description</th>
					<th>Price</th>
				</tr>
				{% for item in items %}
				<tr>
					<td>{{ item.name }} (<a href="#" onclick="remove_from_cart('{{ item.id }}');"><span class="glyphicon glyphicon-trash" style="color: red;"></span></a>)</td>
					<td>{{ item.desc }}</td>
					<td>{{ item.price[:-2] }}.{{ item.price[-2:] }}€</td>
				</tr>
				{% endfor %}
				<tr>
					<td></td>
					<td></td>
					<td></td>
				</tr>
				<tr>
					<td></td>
					<td></td>
					<td><b>Total price: {{ total[:-2] }}.{{ total[-2:] }}</b><span class="glyphicon glyphicon-euro"></span></td>
				</tr>
			</table>
		</div>
		

		<!-- CLEAR CART -->
		<div class="col-sm-6">
			<div class="panel panel-warning">
				<div class="panel-heading"><a href="#" onclick="clear_cart();"><h3>Clear Cart</h3></a></div>
				<div class="panel-footer">This button will clear your cart of any products!</div>
			</div>
		</div>
		<!-- CHECKOUT -->
		<div class="col-sm-6">
			<div class="panel panel-success">
				<div class="panel-heading"><a href="{{ root }}checkout"><h3>Checkout</h3></a></div>
				<div class="panel-footer">This Shop is only for DEMONSTARTION ONLY ! <br>You get NOTHING in exchange for NOTHING ! <br>Your account ballance will reset to 99999 € after every purchase!</div>
			</div>
		</div>
		{% else %}
		<div class="panel panel-default" style="text-align: center;">
			<!-- Default panel contents -->
			<div class="panel-heading"><h1>Your cart is currently empty!</h1></div>
		</div>
		{% endif %}

		<!--
		{% for item in items %}
		<div class="col-sm-4">
			<div class="panel panel-primary">
				<div class="panel-heading">{{ item.name }}</div>
				<div class="panel-footer">{{ item.desc }}</div>
			</div>
		</div>
		{% endfor %}-->
		
	</div>
</div><br>

<br>

<footer class="container-fluid text-center">
	<p>Online Store Copyright</p>  
	<form action = "{{ root }}newsletter/apply" method = "post" class="form-inline">Abboniere meinen Newsletter:
		<input type = "email" class = "form-control" size = "50" placeholder="email@example.com" name="email">
		<input type = "submit" value = "Sign Up" class="btn btn-danger"/>
	</form>
</footer>

</body>
</html>
<script>
	function remove_from_cart(item_id)
    {
		event.preventDefault()
        $.ajax({
            url: '{{ root }}remove_from_cart',
            type: 'POST',
            data: {
                item_id: item_id
            },
            success: function (response) {
				var counter = parseInt($("#items_in_cart_hidden").val());
				counter--;
				$("#items_in_cart_hidden").val(counter);
				$("#items_in_cart").text(counter);
				location.reload()
            },
            error: function (response) {
            }
        });

    };
	function clear_cart()
    {
		event.preventDefault()
        $.ajax({
            url: '{{ root }}clear_cart',
            type: 'POST',
            data: {
                verify: "verify"
            },
            success: function (response) {
				$("#items_in_cart_hidden").val(0);
				$("#items_in_cart").text(0);
				location.reload()
            },
            error: function (response) {
            }
        });

    };
</script>
